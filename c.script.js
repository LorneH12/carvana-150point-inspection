// ======================================================================
// TRANSLATION TABLE (EN / ES / ZH)
// ======================================================================
const TRANSLATIONS = {
  en: {
    "app.title": "Reconditioning Academy",
    "app.subtitle": "150-Point Vehicle Inspection",

    "sidebar.progressTitle": "Course Progress",
    "sidebar.progressSubtitle": "Track your learning journey",

    "nav.welcome": "Welcome",
    "nav.standard": "The Carvana Standard",
    "nav.flow": "Flow in the Recon Center",
    "nav.quality": "Quality & Safety",

    "hero.heading":
      "From arrival to delivery, the 150-point inspection is our promise.",
    "hero.tagline":
      "Learn what the 150-point inspection is, why it matters, and how "done right" looks in the recon center.",

    "welcome.title": '"Welcome"',
    "welcome.intro":
      "Start with a quick overview of how Carvana inspection centers work and where you fit into the process.",

    "standard.heading": "Section One: The Carvana Standard",
    "standard.body1":
      "The Carvana Standard is the company's benchmark for ensuring every vehicle is safe, clean, reconditioned, and ready for delivery. It's the foundation of how Carvana earns customer trust.",
    "standard.body2":
      "Click on the items below to explore the core pillars of the standard and see how your work contributes to every customer experience.",

    "standard.safety.title": "Safety First",
    "standard.safety.title_alt": "Safety First",
    "standard.safety.body":
      "Carvana verifies that every vehicle meets essential safety requirements before it ever reaches a customer. This includes:",
    "standard.safety.brakes": "Brakes",
    "standard.safety.tires": "Tires",
    "standard.safety.steering": "Steering",
    "standard.safety.suspension": "Suspension",
    "standard.safety.lights": "Lights",
    "standard.safety.airbags": "Airbags & onboard diagnostics",
    "standard.safety.note": "If it's not safe, it does not move forward.",

    "standard.mechanical.title": "Full Mechanical Confidence",
    "standard.mechanical.title_alt": "Full Mechanical Confidence",
    "standard.mechanical.body":
      "Beyond safety, every major system is tested and verified to be in working condition so that customers can drive away with confidence.",

    "standard.clean.title": "Cleanliness & Appearance",
    "standard.clean.title_alt": "Cleanliness & Appearance",
    "standard.clean.body":
      "Vehicles are thoroughly detailed inside and out so the car that arrives in a customer's driveway feels truly "like new."",

    "standard.transparency.title": "Transparency & Accuracy",
    "standard.transparency.title_alt": "Transparency & Accuracy",
    "standard.transparency.body":
      "All findings are documented accurately and shared with customers in the vehicle listing so there are no surprises.",

    "flow.heading": "Section Two: Flow in the Recon Center",
    "flow.body1":
      "Every vehicle moves through a planned sequence of steps—from arrival and intake, to mechanical inspection, cosmetic work, detailing, and final quality checks.",
    "flow.body2":
      "Understanding this flow helps you see where your role fits in the process and how timing, communication, and accuracy keep the lane moving efficiently.",
    "flow.body3":
      "Each stage has specific checkpoints and quality standards that ensure vehicles meet the Carvana Standard before moving to the next phase.",

    "quality.heading": "Section Three: Quality & Safety",
    "quality.body1":
      "Quality and safety are everyone's responsibility. This section connects your daily tasks to the bigger picture: safe vehicles on the road, honest listings, and customers who trust that the 150-point inspection is more than just a checklist—it is a promise.",
    "quality.body2":
      "Final inspection checks, proper documentation, and knowing how to escalate safety concerns are critical skills that protect both customers and the Carvana reputation."
  },

  es: {
    "app.title": "Academia de Reacondicionamiento",
    "app.subtitle": "Inspección de Vehículos de 150 Puntos",

    "sidebar.progressTitle": "Progreso del Curso",
    "sidebar.progressSubtitle": "Sigue tu progreso de aprendizaje",

    "nav.welcome": "Bienvenida",
    "nav.standard": "El Estándar Carvana",
    "nav.flow": "Flujo en el Centro de Reacondicionamiento",
    "nav.quality": "Calidad y Seguridad",

    "hero.heading":
      "Desde la llegada hasta la entrega, la inspección de 150 puntos es nuestra promesa.",
    "hero.tagline":
      "Aprende qué es la inspección de 150 puntos, por qué importa y cómo se ve el trabajo bien hecho en el centro de reacondicionamiento.",

    "welcome.title": '"Bienvenida"',
    "welcome.intro":
      "Comienza con una visión general rápida de cómo funcionan los centros de inspección de Carvana y dónde encaja tu trabajo.",

    "standard.heading": "Sección Uno: El Estándar Carvana",
    "standard.body1":
      "El Estándar Carvana es el punto de referencia de la compañía para garantizar que cada vehículo sea seguro, limpio, reacondicionado y listo para la entrega. Es la base de cómo Carvana se gana la confianza del cliente.",
    "standard.body2":
      "Haz clic en los elementos a continuación para explorar los pilares fundamentales del estándar y ver cómo tu trabajo contribuye a cada experiencia del cliente.",

    "standard.safety.title": "Seguridad Primero",
    "standard.safety.title_alt": "Seguridad Primero",
    "standard.safety.body":
      "Carvana verifica que cada vehículo cumpla con los requisitos de seguridad esenciales antes de llegar a un cliente. Esto incluye:",
    "standard.safety.brakes": "Frenos",
    "standard.safety.tires": "Neumáticos",
    "standard.safety.steering": "Dirección",
    "standard.safety.suspension": "Suspensión",
    "standard.safety.lights": "Luces",
    "standard.safety.airbags": "Airbags y diagnósticos a bordo",
    "standard.safety.note":
      "Si no es seguro, el vehículo no avanza al siguiente paso.",

    "standard.mechanical.title": "Confianza Mecánica Completa",
    "standard.mechanical.title_alt": "Confianza Mecánica Completa",
    "standard.mechanical.body":
      "Más allá de la seguridad, se prueba y verifica que cada sistema importante esté en condiciones de funcionamiento para que el cliente conduzca con confianza.",

    "standard.clean.title": "Limpieza y Apariencia",
    "standard.clean.title_alt": "Limpieza y Apariencia",
    "standard.clean.body":
      "Los vehículos se detallan completamente por dentro y por fuera para que el auto que llega a la casa del cliente se sienta como nuevo.",

    "standard.transparency.title": "Transparencia y Precisión",
    "standard.transparency.title_alt": "Transparencia y Precisión",
    "standard.transparency.body":
      "Todos los hallazgos se documentan con precisión y se comparten con los clientes en la publicación del vehículo para que no haya sorpresas.",

    "flow.heading": "Sección Dos: Flujo en el Centro de Reacondicionamiento",
    "flow.body1":
      "Cada vehículo pasa por una secuencia de pasos planificada: desde la llegada y recepción, hasta la inspección mecánica, el trabajo cosmético, el detallado y las verificaciones finales de calidad.",
    "flow.body2":
      "Comprender este flujo te ayuda a ver dónde encaja tu función en el proceso y cómo el tiempo, la comunicación y la precisión mantienen el proceso en movimiento eficiente.",
    "flow.body3":
      "Cada etapa tiene puntos de control y estándares de calidad específicos que garantizan que los vehículos cumplan con el Estándar Carvana antes de pasar a la siguiente fase.",

    "quality.heading": "Sección Tres: Calidad y Seguridad",
    "quality.body1":
      "La calidad y la seguridad son responsabilidad de todos. Esta sección conecta tus tareas diarias con el panorama general: vehículos seguros en la carretera, listados honestos y clientes que confían en que la inspección de 150 puntos es más que una lista de verificación: es una promesa.",
    "quality.body2":
      "Las revisiones finales de inspección, la documentación adecuada y saber cómo escalar inquietudes de seguridad son habilidades críticas que protegen tanto a los clientes como a la reputación de Carvana."
  },

  zh: {
    "app.title": "整备学院",
    "app.subtitle": "150 项车辆检查",

    "sidebar.progressTitle": "课程进度",
    "sidebar.progressSubtitle": "跟踪你的学习旅程",

    "nav.welcome": "欢迎",
    "nav.standard": "Carvana 标准",
    "nav.flow": "整备中心流程",
    "nav.quality": "质量与安全",

    "hero.heading": "从到店到交付，150 项检查是我们的承诺。",
    "hero.tagline":
      "了解什么是 150 项检查、为什么重要，以及在整备中心"做到位"是什么样子。",

    "welcome.title": ""欢迎"",
    "welcome.intro":
      "先快速了解 Carvana 检查中心如何运作，以及你在流程中的角色。",

    "standard.heading": "第一部分：Carvana 标准",
    "standard.body1":
      "Carvana 标准是公司用来确保每辆车安全、整洁、整备完成并准备交付的基准，也是赢得客户信任的基础。",
    "standard.body2":
      "点击下方项目了解标准的核心支柱，并看到你的工作如何影响每一次客户体验。",

    "standard.safety.title": "安全第一",
    "standard.safety.title_alt": "安全第一",
    "standard.safety.body":
      "Carvana 会在车辆交付给客户之前，确认其满足关键安全要求，包括：",
    "standard.safety.brakes": "制动系统",
    "standard.safety.tires": "轮胎",
    "standard.safety.steering": "转向系统",
    "standard.safety.suspension": "悬挂系统",
    "standard.safety.lights": "灯光",
    "standard.safety.airbags": "安全气囊与车载诊断系统",
    "standard.safety.note": "如果不安全，就不会继续流转。",

    "standard.mechanical.title": "机械可靠性",
    "standard.mechanical.title_alt": "机械可靠性",
    "standard.mechanical.body":
      "在安全之上，我们还会测试并验证所有主要系统处于良好工作状态，让客户放心驾驶。",

    "standard.clean.title": "清洁与外观",
    "standard.clean.title_alt": "清洁与外观",
    "standard.clean.body":
      "车辆在交付前会进行彻底内外清洁，让到达客户家门口的车看起来近似"全新"。",

    "standard.transparency.title": "透明与准确",
    "standard.transparency.title_alt": "透明与准确",
    "standard.transparency.body":
      "所有检查结果都会被准确记录，并在车辆信息页对客户公开，确保没有意外。",

    "flow.heading": "第二部分：整备中心流程",
    "flow.body1":
      "每辆车都会通过一系列既定步骤：到站与登记、机械检查、外观整备、精洗以及最终质量检查。",
    "flow.body2":
      "了解此流程有助于你看清自己的角色在过程中的位置，以及时间、沟通和准确性如何让流程高效推进。",
    "flow.body3":
      "每个阶段都有特定的检查点和质量标准，确保车辆在进入下一阶段之前符合 Carvana 标准。",

    "quality.heading": "第三部分：质量与安全",
    "quality.body1":
      "质量与安全是每个人的责任。本部分将你的日常任务与更大的目标联系起来：安全的车辆上路、真实的车辆信息，以及相信 150 项检查不仅是一张表单、更是一份承诺的客户。",
    "quality.body2":
      "最终检查、正确的文档记录以及知道如何上报安全问题，是保护客户和 Carvana 声誉的关键技能。"
  }
};

// ======================================================================
// LANGUAGE SWITCHER
// ======================================================================
(function initLanguage() {
  const langButtons = document.querySelectorAll(".lang-btn");
  const translatableEls = document.querySelectorAll("[data-i18n]");

  function applyLanguage(lang) {
    const dict = TRANSLATIONS[lang] || TRANSLATIONS.en;

    document.documentElement.lang =
      lang === "zh" ? "zh-Hans" : lang;

    translatableEls.forEach((el) => {
      const key = el.dataset.i18n;
      if (!key) return;
      const text =
        (dict && dict[key]) || TRANSLATIONS.en[key] || "";
      if (text) el.textContent = text;
    });
  }

  function setActiveButton(lang) {
    langButtons.forEach((btn) => {
      const isActive = btn.dataset.lang === lang;
      btn.classList.toggle("is-active", isActive);
      btn.setAttribute("aria-pressed", String(isActive));
    });
  }

  langButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang;
      setActiveButton(lang);
      applyLanguage(lang);
    });
  });

  // initial
  setActiveButton("en");
  applyLanguage("en");
})();

// ======================================================================
// SIDEBAR TOGGLE WITH LAYOUT ADJUSTMENTS
// ======================================================================
(function initSidebar() {
  const sidebar = document.getElementById("sidebar");
  const toggle = document.getElementById("sidebarToggle");
  const pageLayout = document.querySelector(".page-layout");
  const mainContent = document.querySelector(".main-content");
  const topBar = document.querySelector(".top-bar");

  if (!sidebar || !toggle) return;

  toggle.addEventListener("click", () => {
    const isCollapsed = sidebar.classList.toggle("is-collapsed");
    
    // Toggle layout classes
    if (isCollapsed) {
      pageLayout.classList.add("sidebar-collapsed");
      mainContent.classList.add("sidebar-collapsed");
    } else {
      pageLayout.classList.remove("sidebar-collapsed");
      mainContent.classList.remove("sidebar-collapsed");
    }
  });
})();

// ======================================================================
// NAVIGATION + PROGRESS
// ======================================================================
(function initNavAndProgress() {
  const navItems = document.querySelectorAll(".nav-item");
  const progressFill = document.getElementById("progressFill");
  const progressPercent = document.getElementById("progressPercent");
  const visited = new Set();

  function updateProgress() {
    const total = navItems.length || 1;
    const percent = Math.round((visited.size / total) * 100);
    progressFill.style.width = `${percent}%`;
    progressPercent.textContent = `${percent}%`;
  }

  navItems.forEach((btn) => {
    const targetSelector = btn.dataset.target;
    const target = document.querySelector(targetSelector);

    btn.addEventListener("click", () => {
      if (target) {
        const y =
          target.getBoundingClientRect().top +
          window.scrollY -
          90;
        window.scrollTo({ top: y, behavior: "smooth" });
      }

      navItems.forEach((n) => n.classList.remove("is-active"));
      btn.classList.add("is-active");
      visited.add(targetSelector);
      updateProgress();
    });
  });

  // Mark hero as visited initially
  visited.add("#hero");
  updateProgress();
})();

// ======================================================================
// ACCORDION
// ======================================================================
(function initAccordion() {
  const items = document.querySelectorAll(".accordion-item");

  items.forEach((item) => {
    const header = item.querySelector(".accordion-header");
    const body = item.querySelector(".accordion-body");
    if (!header || !body) return;

    // Set initial max-height for open items
    if (item.classList.contains("is-open")) {
      body.style.maxHeight = body.scrollHeight + "px";
    }

    header.addEventListener("click", () => {
      const isOpen = item.classList.contains("is-open");

      // Close all
      items.forEach((other) => {
        const otherBody = other.querySelector(".accordion-body");
        other.classList.remove("is-open");
        if (otherBody) otherBody.style.maxHeight = null;
      });

      // Open selected if it was closed
      if (!isOpen) {
        item.classList.add("is-open");
        body.style.maxHeight = body.scrollHeight + "px";
      }
    });
  });
})();
